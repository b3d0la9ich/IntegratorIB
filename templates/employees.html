<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Сотрудники</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='employees.css') }}">
</head>
<body>
<header class="header">
    <div class="container">
        <h1>Список сотрудников</h1>
        <nav>
            <a href="{{ url_for('dashboard') }}">← Назад в дашборд</a>
        </nav>
    </div>
</header>

<main class="container">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <table class="employees-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Логин</th>
            <th>Квалификация</th>
            <th>Специализации (сферы)</th>
            <th>Активные проекты</th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        {% for emp in employees %}
            <tr>
                <td>{{ emp.id }}</td>
                <td>
                    {{ emp.username }}
                    {% if emp.is_admin %}<span class="badge">админ</span>{% endif %}
                </td>
                <td>{{ emp.qualification }}</td>
                <td>
                    {% if emp.industries %}
                        {{ emp.industries | map(attribute='name') | join(', ') }}
                    {% else %}
                        <span class="muted">Нет специализаций</span>
                    {% endif %}
                </td>
                <td>
                    {{ emp.projects | selectattr('status', 'ne', 'завершён') | list | length }}
                </td>
                <td class="actions">
                    <a href="{{ url_for('edit_employee_specializations', user_id=emp.id) }}" class="btn-sm">
                        Специализации
                    </a>

                    <form method="POST" action="{{ url_for('delete_employee', user_id=emp.id) }}" onsubmit="return confirm('Удалить сотрудника?');">
                        <button type="submit" class="btn-sm btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</main>
</body>
</html>
